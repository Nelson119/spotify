"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},app={};app.partial={};var debug=/localhost[:]9000|nelson119.github.io/.test(location.href),share={facebook:function(e,t){e=encodeURIComponent(e||location.href+"?utm_source=facebook&utm_medium=fbshare_m&utm_campaign=roseanni"),t=encodeURIComponent(t||document.title),window.open("https://www.facebook.com/sharer.php?u="+e+"&amp;t="+t)},googleplus:function(e){e=encodeURIComponent(e||location.href+"?utm_source=g+&utm_medium=fbshare_m&utm_campaign=roseanni"),window.open("https://plus.google.com/share?url="+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},email:function(e,t){e=encodeURIComponent(e||location.href+"?utm_source=email&utm_medium=fbshare_m&utm_campaign=roseanni"),t=encodeURIComponent(t||document.title);var o=encodeURIComponent(""+e+" #"+t);window.open("https://mail.google.com/mail/?view=cm&fs=1&to=&su=與你分享:"+t+"&body="+o+"&bcc=")}},api=new SpotifyWebApi;$(function(){$.each(app.partial,function(e,t){t()}),$(window).trigger("resize"),$(".share .facebook").on("click",function(e){return share.facebook(),e.stopPropagation(),e.preventDefault(),!1}),$(".share .googleplus").on("click",function(e){return share.googleplus(),e.stopPropagation(),e.preventDefault(),!1}),$(".share .email").on("click",function(e){return share.email(),e.stopPropagation(),e.preventDefault(),!1})}),$.fn.hasAttr=function(e){var t=$(this).attr(e);return"undefined"!==("undefined"==typeof t?"undefined":_typeof(t))&&t!==!1},app.partial.ga=function(){},function(e){function t(e){return"https://accounts.spotify.com/authorize?client_id="+o+"&redirect_uri="+encodeURIComponent(n)+"&scope="+encodeURIComponent(e.join(" "))+"&response_type=token"}var o="",n="";return/localhost[:]9000/.test(location.href)?(o="71aac3cffd9648a889c174c4b32f7d57",n="http://localhost:9000/callback.html"):(o="71aac3cffd9648a889c174c4b32f7d57",n="http://nelson.works/spotify/callback.html"),e.auth={openLogin:function(e){var o=t(["user-read-private","playlist-read-private","playlist-modify-public","playlist-modify-private","user-library-read","user-library-modify","user-follow-read","user-follow-modify"]),n=450,a=730,i=screen.width/2-n/2,c=screen.height/2-a/2;window.open(o,"Spotify","menubar=no,location=no,resizable=no,scrollbars=no,status=no, width="+n+", height="+a+", top="+c+", left="+i);$(window).one("message",function(t){console.log("got postmessage",t);var o=JSON.parse(t.originalEvent.data);"access_token"==o.type&&(auth.setAccessToken(o.access_token,o.expires_in||60),api.setAccessToken(o.access_token,o.expires_in||60),auth.checkUser(!0),"function"==typeof e&&e())})},getAccessToken:function(){var e=0+localStorage.getItem("pa_expires","0");if((new Date).getTime()>e)return"";var t=localStorage.getItem("pa_token","");return t},setAccessToken:function(e,t){localStorage.setItem("pa_token",e),localStorage.setItem("pa_expires",(new Date).getTime()+t)},getUsername:function(){var e=localStorage.getItem("pa_username","");return e},setUsername:function(e){localStorage.setItem("pa_username",e)},getUserCountry:function(){var e=localStorage.getItem("pa_usercountry","US");return e},setUserCountry:function(e){localStorage.setItem("pa_usercountry",e)},checkUser:function(e){api.getMe().then(function(e){auth.setUsername(e.id),auth.setUserCountry(e.country),console.log(e);var t=$(".user-info").html();$(".user-info").html(t.replace(/[{][{]display_name[}][}]/,e.display_name).replace(/[{][{]country[}][}]/,e.country))},function(e){auth.openLogin(e)})}}}(window||void 0),app.partial.home=function(){$("#login").click(function(){auth.openLogin(function(){api.getUserPlaylists("spotifytaiwan").then(function(e){$("select").html(""),$(e.items).each(function(e,t){var o=$("<option></option>").html(t.name).on("click",function(){api.getPlaylistTracks("spotifytaiwan",t.id).then(function(e){$(".list-1 ol").html(""),$(e.items).each(function(){var e=$("<li></li>").addClass("col-lg-4 col-md-4 col-sm-4 col-xs-4");e.append($("<p></p>").html(this.track.name+"-"+this.track.album.name));var t=[];$.each(this.track.artists,function(){t.push(this.name)}),e.append($("<p></p>").html(t.join(", "))),$(".list-1 ol").append(e)})},function(e){console.error(e)})});$("select").append(o)}),$("select option:eq(0)").trigger("click")},function(e){console.error(e)})})});$("select").on("change",function(){$("option:selected",this).trigger("click")}),$("#top50").on("click",function(){auth.openLogin(function(){api.getRecommendations({limit:50,target_mode:1,market:"TW",seed_genres:"mandopop, cantopop",min_popularity:15}).then(function(e){console.log(e),$(".list-3 ol").html(""),$(e.tracks).each(function(){var e=$("<li></li>").addClass("col-lg-4 col-md-4 col-sm-4 col-xs-4");e.append($("<p></p>").html(this.name+"-"+this.album.name));var t=[];$.each(this.artists,function(){t.push(this.name)}),e.append($("<p></p>").html(t.join(", "))),$(".list-3 ol").append(e)})},function(e){console.error(e)})})}),$("[name=search]").on("input",function(e){$(".list-2 ol").html(""),api.searchTracks($(this).val(),{limit:50,type:"track"}).then(function(e){$(e.tracks.items).each(function(){var e=$("<li></li>").addClass("col-lg-4 col-md-4 col-sm-4 col-xs-4");e.append($("<p></p>").html(this.name+"-"+this.album.name));var t=[];$.each(this.artists,function(){t.push(this.name)}),e.append($("<p></p>").html(t.join(", "))),$(".list-2 ol").append(e)})},function(e){console.error(e)})})};